require("dotenv").config();
const jwt = require("jsonwebtoken")

module.exports = {
    validateToken: (req, res, next) => {
        //initialize retrieve token dari cookies
        const cookie = req.cookies.tokenUser

        if(!cookie){
            res.json({
                message: "token tidak ditemukan"
            })
            return
        }

        const token = cookie

        if(!token){
            res.json("No token found")
            return
        }

        try{
            //verify
            const payload = jwt.verify(token, process.env.JWT_KEY)
            req.payload = payload
            next()
        }catch(e){
            res.json("invalid token")
            console.log(e)
            return
        }
    }
}